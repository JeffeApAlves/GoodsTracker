/*
 * Accelerometer.c
 *
 *  Created on: 29/06/2017
 *      Author: Jefferson
 */

#include "MMA8451.h"

#include "application.h"
#include "Accelerometer.h"

//Entidade com as informações de aceleração
//Accelerometer	acceInfo;

// Fila onde é publicado as informações
QueueHandle_t	xQueueAcc;

// Hanlde da task
TaskHandle_t	xHandleAccelTask;

static const TickType_t xTaskDelay = (200 / portTICK_PERIOD_MS);

/*
 *
 * Task de aquisição de dados do acelerometro.
 * Após obter com sucesso os valores são publicado na fila para os consumidores
 *
 */
void accelerometer_task(void) {

	Accelerometer	acceInfo;

	if(MMA845x_getXYZ(&acceInfo)){

		if(xQueueSendToBack( xQueueAcc ,  &acceInfo, ( TickType_t ) 1 ) ){

			xTaskNotify( xHandleCallBackTask , BIT_UPDATE_ACCE , eSetBits );
		}
	}

	vTaskDelay(xTaskDelay);
}
//------------------------------------------------------------------------

void accelerometer_init(void){

	xQueueAcc		= xQueueCreate( 1, sizeof( Accelerometer ));

//	clearAccelerometer(&acceInfo);

	MMA845x_init();
}
//------------------------------------------------------------------------

void deInitAccelerometer(void){

	MMA845x_deInit();
}
//------------------------------------------------------------------------
