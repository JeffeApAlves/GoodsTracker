#include <stdio.h>
#include <string.h>

#include "XF1.h"

#include "clock.h"
#include "Serialization.h"

void tlm2String(Telemetria* tlm,PayLoad* ans){

	if(tlm!=NULL && ans!= NULL){

		clearArrayPayLoad(ans);

		XF1_xsprintf(ans->Data,"%.8f%c%.8f%c%d%c%d%c%d%c%.3f%c%.3f%c%.2f%c%d%c%d%c%d%c%d",
				tlm->gps.Lat, 			CHAR_SEPARATOR,
				tlm->gps.Lng, 			CHAR_SEPARATOR,
				tlm->accelerometer.x,	CHAR_SEPARATOR,
				tlm->accelerometer.y, 	CHAR_SEPARATOR,
				tlm->accelerometer.z, 	CHAR_SEPARATOR,
				tlm->accelerometer.x_g,	CHAR_SEPARATOR,
				tlm->accelerometer.y_g,	CHAR_SEPARATOR,
				tlm->accelerometer.z_g,	CHAR_SEPARATOR,
				tlm->gps.Speed, 		CHAR_SEPARATOR,
				tlm->tank.Level, 		CHAR_SEPARATOR,
				tlm->tank.Lock, 		CHAR_SEPARATOR,
				strToTimeStamp(tlm->gps.Date,tlm->gps.Time_UTC));

		ans->Length = strlen(ans->Data);
	}
}
//------------------------------------------------------------------------

void header2String(Header* header,char* out){

	char resource[4];

	getResourceName(resource,header->resource);

	XF1_xsprintf(out,"%05d%c%05d%c%010d%c%s%c%s%c%03d%c",
			header->address, 		CHAR_SEPARATOR,
			header->dest, 			CHAR_SEPARATOR,
			header->time_stamp,		CHAR_SEPARATOR,
			header->operacao, 		CHAR_SEPARATOR,
			resource,				CHAR_SEPARATOR,
			header->lengthPayLoad,	CHAR_SEPARATOR
	);
}
//------------------------------------------------------------------------
