/*
 * Communication.c
 *
 *  Created on: Sep 24, 2017
 *      Author: Jefferson
 */


static void rxPackage_task(){

	while(1){

		processRx();

		vTaskDelay(xCommunicationDelay);

		EventBits_t uxBits = xEventGroupWaitBits(
									communication_event,
									BIT_RX_FRAME,
									pdTRUE,
									pdFALSE,
									portMAX_DELAY );

		if(uxBits & BIT_RX_FRAME){

			CommunicationPackage package;

			while (xQueueReceive(xQueueRxPackage, &package, (TickType_t ) 1)) {

				publishFrame(&package);
			}
		}
	}
}
//------------------------------------------------------------------------------------

/**
 * Task para envios dos frames, recebidos com sucesso pelo broker ou adicionados pela aplicação, na UART.
 *
 */
static void txPackage_task(){

	while(1){

		CommunicationPackage package;

		EventBits_t uxBits = xEventGroupWaitBits(
									communication_event,
									BIT_TX_FRAME,
									pdTRUE,
									pdFALSE,
									portMAX_DELAY );

		if(uxBits & BIT_TX_FRAME){

			while (xQueueReceive(xQueueTxPackage, &package, (TickType_t ) 1)) {

				sendPackage(&package);
			}
		}
	}
}
//------------------------------------------------------------------------------------




