/*
 * DataFrame.c
 *
 *  Created on: Aug 31, 2017
 *      Author: Jefferson
 */

#include <CommunicationFrame.h>
#include <string.h>


void AppendPayLoad(PayLoad* payload,const char* data){

	strcat(payload->Data,data);
	payload->Length = strlen(payload->Data);
}
//------------------------------------------------------------------------

uint16 getNumField(char* str,const char a_delim) {

	uint16 i,f;

	i		= 0;
	f		= 0;

	while((str[i]!='\0') && (i<LEN_PAYLOAD)){

		if(str[i++]==a_delim){

			f++;
		}
	}

	return f+1;
}
//------------------------------------------------------------------------

void getField(char* str, char* out,uint16 num_field,const char a_delim) {

	uint16 i,start,end,index_delim;

	index_delim	= 0;
	start		= 0;
	end			= 0;
	out[0]		= '\0';

	for(i=0;i<LEN_PAYLOAD;i++){

		if(str[i]=='\0'){

			end = i;
			break;
		}

		if(str[i]==a_delim){

			if(index_delim==num_field){

				//Se o proximo caracter for um delimitador o campo esta vazio ex: '::'
				if(str[i+1]==a_delim){
					break;
				}

				start = i+1;
			}

			if(index_delim==(num_field+1)){

				end = i;
				break;
			}

			// Proximo delimitador
			index_delim++;
		}
	}

	if((end-start)>0){

		strncpy(out,str+start,end-start);
		out[end-start] = '\0';
	}
}
//------------------------------------------------------------------------

